# 自适应学习系统学科内容替换完整指南

## 概述
本指南详细记录了如何将一个学科的自适应学习系统（如"牙周病学"）完整转换为另一个学科（如"民法学"或"管理学"）的所有修改步骤和注意事项。

---

## 一、核心配置文件修改

### 1. config/settings.py
**修改项：**
- `APP_ICON`：系统图标（如 🦷 → ⚖️ → 📊）
- `APP_TITLE_CN`：中文标题
- `APP_TITLE_EN`：英文标题（如 "PERIODONTAL AI" → "CIVIL LAW" → "MANAGEMENT"）
- `APP_DESCRIPTION`：系统描述

**注意事项：**
- 图标要符合学科特点
- 英文标题要全大写且语义准确

---

## 二、数据文件修改（data/目录）

### 1. data/abilities.py
**修改内容：**
- 将所有能力项从原学科改为目标学科
- 能力ID保持不变（A1-A10）
- 修改能力名称、分类、描述

**示例：**
```python
# 原：{"id": "A1", "name": "牙周组织解剖识别", "category": "基础能力"}
# 改：{"id": "A1", "name": "民法基础理论", "category": "基础能力"}
# 或：{"id": "A1", "name": "管理学基础理论", "category": "基础能力"}
```

### 2. data/cases.py
**修改内容：**
- 替换所有案例内容
- 保持字段结构：id, title, category, subcategory, difficulty, keywords, case_info, court_opinion, related_knowledge, questions

**关键字段说明：**
- `case_info`：案件事实/案例背景
- `court_opinion`：法院观点/案例分析（需包含【判决结果】或【处理结果】段落）
- `diagnosis`：由 category + subcategory 自动组成

### 3. data/knowledge_graph.py
**修改内容：**
- 整个知识图谱结构
- 模块数量和名称
- 章节和知识点

**结构示例：**
```python
# 民法学：7个编（总则、物权、合同、人格权、婚姻家庭、继承、侵权）
# 管理学：可能是6-8个模块（管理基础、组织、领导、控制、战略等）
```

---

## 三、模块文件修改（modules/目录）

### 1. modules/auth.py
**修改项：**
- 登录页图标：`st.markdown("# 🦷")`
- 系统描述文字

### 2. modules/case_library.py
**关键修改点：**

#### A. 模块描述和注释
```python
# 第3行："""民法案例库模块""" 或 """管理学案例库模块"""
# 第67行："""搜索案例（仅本地开发可用，云端返回None）"""
# 第108行："""从Neo4j获取案例详情"""
```

#### B. adapt_case_for_display函数（约140-160行）
**最关键的函数！** 需要修改：
```python
adapted["diagnosis_analysis"] = {
    "clinical_exam": {"title": "案件事实", "items": [...]},  # 或"案例背景"
    "radiographic": {"title": "法院观点", "items": [...]},   # 或"案例分析"
    "differential": {"title": "相关知识", "items": [...]}
}
```

#### C. 界面文字替换
- 第238行：`st.markdown("### 📂 选择学习案例")`
- 第240行：`case_options = {f"⚖️ {c['title']}": c}`（图标改为学科相关）
- 第242行：`"选择案例进行学习"`
- 第252行：`log_case_activity("查看案例")`

#### D. 案例显示标签
- "病历号" → "案例编号"
- "患者信息" → 删除或改为"案例信息"
- "主诉" → "案件缘起"/"案例背景"
- "现病史" → "案件经过"/"案例详情"
- "既往史与全身情况" → "相关背景"
- "主要症状" → "争议焦点"/"关键问题"
- "临床表现" → "案件细节"/"具体情况"
- "辅助检查" → "证据材料"/"数据分析"
- "临床诊断" → "法院认定"/"结论认定"

#### E. Tab标签名称（约295行）
```python
tab1, tab2, tab3, tab4 = st.tabs([
    "📋 案件事实",      # 或"📋 案例背景"
    "⚖️ 法律分析",      # 或"📊 案例分析"
    "📝 判决结果",      # 或"💡 解决方案"
    "💡 学习要点"
])
```

#### F. 默认值修改
- 第313行：`'当事人之间无其他法律关系'`（根据学科调整）
- 第391行：学习要点默认值
- 第428行：笔记placeholder文字

#### G. HTML模板使用单行
所有HTML内容必须使用单行格式，避免显示`</div>`：
```python
# 错误：
st.markdown(f"""
<div>
    {content}
</div>
""", unsafe_allow_html=True)

# 正确：
st.markdown(f'<div>{content}</div>', unsafe_allow_html=True)
```

### 3. modules/knowledge_graph.py

#### A. 知识点详情字典（约165-196行）
替换32个知识点的title和description为目标学科内容

#### B. example_modules结构（约200-270行）
完整替换模块结构：
```python
example_modules = {
    "M1": {"name": "模块1名称", "description": "...", "chapters": {...}},
    # ... 根据学科调整模块数量和内容
}
```

#### C. 知识点关联关系（约272-298行）
更新knowledge_links列表中的所有关联关系

#### D. 章节描述字典（约320-340行）
更新chapter_descriptions中的所有章节解读

#### E. 模块下拉菜单（约495-508行）
```python
modules = [
    ("全部", None),
    ("M1 - 总则编", "M1"),  # 根据学科调整
    # ...
]
```

#### F. Tooltip提示（约314行）
修改："临床技能" → "实务技能"/"应用技能"

### 4. modules/ability_recommender.py

#### A. 能力知识点映射（约92-102行）
```python
ability_knowledge_map = {
    "A1": [("知识点1", "基础", 0.9), ...],
    # ... 为10个能力配置对应的知识点
}
```

#### B. AI推荐失败时的示例（约177-211行）
更新学习路径推荐的示例文本

#### C. 能力列表（约230-239行）
完整替换10个能力的定义

### 5. modules/classroom_interaction.py

#### A. 练习题目（约303-307行）
```python
practice_questions = [
    "目标学科的问题1",
    "目标学科的问题2",
    "目标学科的问题3"
]
```

### 6. modules/analytics.py

#### A. 示例数据（约630-735行）
更新sample_activity_data中的案例名称和活动记录

---

## 四、主程序文件修改（app.py）

### 1. 页面标题和描述
- Streamlit页面配置
- 欢迎页面的系统介绍文字
- 导航栏文字

### 2. 教师端导航按钮
确保图标和文字统一：
```python
if st.button("📚 案例库", ...):  # 不是"病例库"
if st.button("🎯 能力推荐", ...):  # 检查是否有医学术语
```

---

## 五、初始化脚本修改（scripts/目录）

### 1. scripts/init_elasticsearch.py
**重要！** 替换30个知识点：
```python
knowledge_points = [
    {"id": "KP001", "name": "目标学科知识点1", "level": "基础"},
    # ... 30个知识点
]
```

### 2. scripts/init_neo4j.py
如果有初始化数据，也需要相应修改

---

## 六、全局搜索替换清单

### 必须搜索并替换的术语：

#### 医学术语（如从牙周病学转换）
1. **搜索词：** `病例|病史|临床|诊断|治疗|患者|症状|检查|手术|操作|疾病`
   - 替换建议：案例、背景、分析、认定、方案、当事人、问题、调查等

2. **搜索词：** `牙周|牙齿|牙龈|口腔|periodon`
   - 完全删除或替换为目标学科术语

3. **搜索词：** `洁治|刮治|探诊|X线|影像|龈|SPT`
   - 替换为目标学科的专业术语

#### 图标检查
4. **搜索词：** `🦷|🏥|🩺|💊|🔬`
   - 民法学：⚖️📋📜⚖️
   - 管理学：📊📈💼🎯

#### 字段名检查
5. **搜索词：** `diagnosis|treatment|clinical|patient|medical`
   - 检查是否需要改为中性词如：conclusion, solution, analysis, subject

---

## 七、关键注意事项

### 1. 编码问题
- 如果看到"????"或乱码，检查文件编码是否为UTF-8
- Python文件开头加上：`# -*- coding: utf-8 -*-`

### 2. HTML显示问题
- **永远使用单行HTML**，不要用三引号多行字符串
- 示例：`st.markdown(f'<div>{content}</div>', unsafe_allow_html=True)`

### 3. 默认值处理
- 所有`.get('field')`后面都要加` or '默认值'`
- 示例：`exam.get('title', '') or '事实认定'`

### 4. 数据结构检查
- 确保`adapt_case_for_display`函数中的字段映射正确
- 检查所有字典是否用`isinstance(obj, dict)`验证

### 5. 缓存清理
- 修改后重启系统：`Ctrl+C` 然后重新运行
- 如果还有问题，清理Streamlit缓存：删除`.streamlit/cache`目录

---

## 八、测试检查清单

### 学生端测试
- [ ] 登录页面显示正确的系统名称和图标
- [ ] 四个模块都无原学科内容残留
- [ ] 知识图谱：模块名称正确，下拉菜单正确
- [ ] 案例库：所有标签、标题、内容都是目标学科
- [ ] 能力推荐：10个能力都是目标学科能力
- [ ] 课中互动：练习题是目标学科相关

### 教师端测试
- [ ] 所有导航按钮文字正确
- [ ] 学生管理功能正常
- [ ] 数据分析显示的案例名称正确
- [ ] 调试工具可正常访问

### 内容完整性测试
- [ ] 案例详情页：
  - 案例标题显示正确
  - Tab1（事实）：无问号，无`</div>`
  - Tab2（分析）：法院认定显示正确，无问号
  - Tab3（结果）：判决结果显示完整，无`</div>`
  - Tab4（要点）：学习要点无医学术语
- [ ] 知识图谱：
  - 模块数量正确（如7个编、6个模块）
  - 点击节点显示的tooltip内容正确
  - 关联关系合理
- [ ] 能力推荐：
  - 能力分类合理
  - AI推荐内容相关

---

## 九、常见问题排查

### 问题1：显示问号（????）
**原因：** 字段title为空或None
**解决：** 使用 `field.get('title', '') or '默认标题'`

### 问题2：显示`</div>`标签
**原因：** 多行HTML字符串格式问题
**解决：** 改用单行：`st.markdown(f'<div>...</div>', unsafe_allow_html=True)`

### 问题3：案例不显示
**原因：** `adapt_case_for_display`函数未定义或定义重复
**解决：** 检查函数只定义一次，且有`@st.cache_data`装饰器

### 问题4：还有原学科内容
**原因：** 遗漏某些文件或默认值
**解决：** 使用全局搜索，逐个关键词检查

### 问题5：中文显示为乱码
**原因：** 文件编码问题
**解决：** 
```python
# 文件开头加上
# -*- coding: utf-8 -*-
```

---

## 十、完整修改流程建议

### 步骤1：准备阶段（30分钟）
1. 备份整个项目
2. 整理目标学科的内容框架
3. 准备至少3个完整案例
4. 准备10个能力项的描述
5. 准备知识图谱结构（模块-章节-知识点）

### 步骤2：数据层修改（1小时）
1. 修改 data/abilities.py
2. 修改 data/cases.py
3. 修改 data/knowledge_graph.py
4. 修改 scripts/init_elasticsearch.py

### 步骤3：配置层修改（15分钟）
1. 修改 config/settings.py

### 步骤4：模块层修改（2-3小时）
1. 修改 modules/auth.py（登录页）
2. 修改 modules/case_library.py（最复杂）
3. 修改 modules/knowledge_graph.py
4. 修改 modules/ability_recommender.py
5. 修改 modules/classroom_interaction.py
6. 修改 modules/analytics.py

### 步骤5：全局检查（1小时）
1. 全局搜索医学术语
2. 全局搜索"病例""诊断""治疗"等
3. 检查所有图标
4. 检查所有默认值

### 步骤6：测试验证（1小时）
1. 学生端完整测试
2. 教师端完整测试
3. 每个案例详细检查
4. 每个模块详细检查

### 预计总时间：6-8小时

---

## 十一、快速参考表

| 原术语 | 民法学 | 管理学 | 通用 |
|-------|--------|--------|------|
| 病例 | 案例 | 案例 | 案例 |
| 诊断 | 认定 | 分析 | 判断 |
| 治疗方案 | 判决结果 | 解决方案 | 处理方案 |
| 患者 | 当事人 | 组织/企业 | 主体 |
| 症状 | 争议焦点 | 问题表现 | 关键问题 |
| 病史 | 案件事实 | 案例背景 | 背景信息 |
| 临床检查 | 事实认定 | 现状调查 | 情况分析 |
| X线片 | 法律依据 | 数据分析 | 证据材料 |
| 治疗 | 裁判 | 管理 | 处理 |

---

## 十二、提供给AI的完整提示词模板

```
请帮我将这个自适应学习系统从【原学科】转换为【目标学科】。

系统结构：
- 配置文件：config/settings.py
- 数据文件：data/abilities.py, data/cases.py, data/knowledge_graph.py
- 模块文件：modules/下的6个模块
- 初始化脚本：scripts/init_elasticsearch.py

目标学科信息：
- 学科名称：【管理学/经济学/...】
- 图标建议：【📊/💼/...】
- 知识结构：【6-8个模块，如：管理基础、组织、领导...】
- 案例数量：【至少3个】

关键修改要求：
1. 完全清除原学科所有术语（病例→案例，诊断→分析等）
2. 修改所有图标为目标学科相关图标
3. 更新10个能力项为目标学科能力
4. 替换所有案例内容，保持字段结构
5. 重构知识图谱为目标学科体系
6. 所有HTML使用单行格式，避免显示</div>
7. 所有title字段添加默认值，避免显示????
8. 检查并修改所有默认值文本

参考本文档中的详细步骤和注意事项进行修改。
```

---

## 附录：完整文件修改清单

✅ **必改文件：**
1. config/settings.py
2. data/abilities.py
3. data/cases.py
4. data/knowledge_graph.py
5. modules/auth.py
6. modules/case_library.py（最复杂）
7. modules/knowledge_graph.py
8. modules/ability_recommender.py
9. modules/classroom_interaction.py
10. scripts/init_elasticsearch.py

⚠️ **选改文件：**
1. modules/analytics.py（示例数据）
2. app.py（如果有学科相关文字）
3. README.md（文档说明）

❌ **不需要改：**
1. requirements.txt
2. config/stats_config.json
3. scripts/init_neo4j.py（除非有初始化数据）

---

**文档版本：** v1.0
**创建日期：** 2026年1月5日
**适用系统：** 基于Streamlit + Neo4j + Elasticsearch的自适应学习系统
**原始案例：** 牙周病学 → 民法学
**预期应用：** 管理学、经济学等其他学科

---

*本指南基于实际修改经验总结，涵盖了所有可能遇到的问题和解决方案。*
